<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riverdale Logistics - Complete Lead Bot</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #0A0E27 0%, #1A1A2E 100%);
            color: #F5F5F5;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FF6B35, #F7B801);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .config-notice {
            background: rgba(247, 184, 1, 0.1);
            border: 2px solid #F7B801;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .config-notice h3 {
            color: #F7B801;
            margin-bottom: 1rem;
        }

        .config-notice button {
            background: linear-gradient(135deg, #F7B801, #FF6B35);
            margin-top: 1rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            overflow-x: auto;
        }

        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
        }

        .tab:hover {
            color: rgba(255, 255, 255, 0.9);
        }

        .tab.active {
            color: #F7B801;
            border-bottom-color: #F7B801;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FF6B35, #F7B801);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            margin-top: 0.5rem;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #F7B801;
            margin-bottom: 1.5rem;
        }

        .campaign-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .campaign-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .campaign-card:hover {
            border-color: #FF6B35;
            transform: translateY(-4px);
        }

        .campaign-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .campaign-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #F7B801;
            margin-bottom: 0.5rem;
        }

        button {
            background: linear-gradient(135deg, #FF6B35, #F7B801);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1A1A2E 0%, #16213E 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 1.3rem;
        }

        label {
            display: block;
            font-weight: 600;
            color: #F7B801;
            font-size: 0.85rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        input, textarea, select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--light);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #FF6B35;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .help-text {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 0.4rem;
        }

        .success-message {
            background: rgba(6, 214, 160, 0.1);
            border: 1px solid #06D6A0;
            color: #06D6A0;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .error-message {
            background: rgba(239, 71, 111, 0.1);
            border: 1px solid #EF476F;
            color: #EF476F;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .lead-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #FF6B35;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 3rem;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #FF6B35;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöö Riverdale Logistics - Lead Generation System</h1>
            <p class="subtitle">Lead Generation ‚Ä¢ Email ‚Ä¢ SMS ‚Ä¢ Reviews ‚Ä¢ Case Studies</p>
        </header>

        <!-- Configuration Notice -->
        <div class="config-notice" id="configNotice">
            <h3>‚öôÔ∏è Setup Required</h3>
            <p>Configure your API keys to enable email, SMS, and automation features.</p>
            <button onclick="openConfig()">Configure Now</button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</div>
            <div class="tab" onclick="switchTab('campaigns')">üéØ Campaigns</div>
            <div class="tab" onclick="switchTab('leads')">üë• Leads</div>
            <div class="tab" onclick="switchTab('reviews')">‚≠ê Reviews</div>
            <div class="tab" onclick="switchTab('casestudies')">üìö Case Studies</div>
            <div class="tab" onclick="switchTab('predictive')">üîî Predictive</div>
            <div class="tab" onclick="switchTab('settings')">‚öôÔ∏è Settings</div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalLeads">0</div>
                    <div class="stat-label">Total Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="emailsSent">0</div>
                    <div class="stat-label">Emails Sent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="smsSent">0</div>
                    <div class="stat-label">SMS Sent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="meetingsBooked">0</div>
                    <div class="stat-label">Meetings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="reviewsReceived">0</div>
                    <div class="stat-label">Reviews</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">üìà Today's Activity</div>
                <div id="activityLog" style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; max-height: 300px; overflow-y: auto;">
                    <div style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">System initialized - Ready to go!</div>
                </div>
            </div>
        </div>

        <!-- Campaigns Tab -->
        <div id="campaigns" class="tab-content">
            <div class="panel">
                <div class="panel-title">üéØ Launch Campaign</div>
                
                <div class="campaign-grid">
                    <div class="campaign-card" onclick="launchCampaign('medical')">
                        <div class="campaign-icon">üè•</div>
                        <div class="campaign-title">Medical Facilities</div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
                            Hospitals, clinics, pharmacies
                        </div>
                    </div>

                    <div class="campaign-card" onclick="launchCampaign('furniture')">
                        <div class="campaign-icon">üõãÔ∏è</div>
                        <div class="campaign-title">Furniture & Retail</div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
                            Furniture stores, showrooms
                        </div>
                    </div>

                    <div class="campaign-card" onclick="launchCampaign('legal')">
                        <div class="campaign-icon">‚öñÔ∏è</div>
                        <div class="campaign-title">Legal & Corporate</div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
                            Law firms, offices
                        </div>
                    </div>

                    <div class="campaign-card" onclick="launchCampaign('construction')">
                        <div class="campaign-icon">üèóÔ∏è</div>
                        <div class="campaign-title">Construction</div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
                            Job sites, contractors
                        </div>
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p id="loadingText" style="color: #F7B801; font-weight: 700;">
                    Finding leads...
                </p>
            </div>
        </div>

        <!-- Leads Tab -->
        <div id="leads" class="tab-content">
            <div class="panel">
                <div class="panel-title">üë• Active Leads</div>
                <div id="leadsContainer">
                    <div style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">
                        <p>No leads yet. Launch a campaign to get started!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reviews Tab -->
        <div id="reviews" class="tab-content">
            <div class="panel">
                <div class="panel-title">‚≠ê Review Management</div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="reviewsRequested">0</div>
                        <div class="stat-label">Requests Sent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="reviewsReceived2">0</div>
                        <div class="stat-label">Reviews Received</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="reviewRate">0%</div>
                        <div class="stat-label">Response Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgRating">0.0</div>
                        <div class="stat-label">Avg Rating</div>
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px;">
                    <h3 style="margin-bottom: 1rem;">Mark Delivery Complete & Request Review:</h3>
                    <form id="deliveryCompleteForm" style="display: grid; gap: 1rem;">
                        <input type="text" id="delivCustomerName" placeholder="Customer Name" required>
                        <input type="tel" id="delivCustomerPhone" placeholder="Customer Phone (e.g., +12025551234)" required>
                        <input type="email" id="delivCustomerEmail" placeholder="Customer Email">
                        <button type="submit">‚úÖ Mark Completed & Request Review</button>
                    </form>
                </div>

                <div id="reviewsList" style="margin-top: 2rem;"></div>
            </div>
        </div>

        <!-- Case Studies Tab -->
        <div id="casestudies" class="tab-content">
            <div class="panel">
                <div class="panel-title">üìö Case Studies</div>
                
                <button onclick="createNewCaseStudy()" style="margin-bottom: 2rem;">
                    ‚ûï Create New Case Study
                </button>

                <div id="caseStudiesList">
                    <div style="text-align: center; padding: 2rem; color: rgba(255,255,255,0.6);">
                        <p>No case studies yet. Create your first one after completing successful deliveries!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Predictive Tab -->
        <div id="predictive" class="tab-content">
            <div class="panel">
                <div class="panel-title">üîî Predictive Lead Generation</div>
                
                <div style="background: rgba(247,184,1,0.1); border: 2px solid #F7B801; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                    <h3 style="color: #F7B801; margin-bottom: 1rem;">How It Works:</h3>
                    <ol style="line-height: 1.8; padding-left: 1.5rem;">
                        <li>Set up Google Alerts for business news in DMV</li>
                        <li>When you get an alert email, paste the content below</li>
                        <li>Bot extracts companies and researches them</li>
                        <li>Qualified leads are added automatically</li>
                        <li>You get instant SMS notification</li>
                    </ol>
                </div>

                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px;">
                    <h3 style="margin-bottom: 1rem;">Process Google Alert:</h3>
                    <textarea id="alertContent" rows="8" placeholder="Paste Google Alert email content here..." style="width: 100%; margin-bottom: 1rem;"></textarea>
                    
                    <select id="alertType" style="margin-bottom: 1rem;">
                        <option value="new_business">New Business Opening</option>
                        <option value="office_move">Office Relocation</option>
                        <option value="expansion">Business Expansion</option>
                        <option value="construction">Construction Project</option>
                        <option value="medical">Medical Facility</option>
                        <option value="retail">Retail Opening</option>
                    </select>
                    
                    <button onclick="processGoogleAlert()">üîç Process Alert & Find Leads</button>
                </div>

                <div class="stats-grid" style="margin-top: 2rem;">
                    <div class="stat-card">
                        <div class="stat-value" id="alertsProcessed">0</div>
                        <div class="stat-label">Alerts Processed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="predictiveLeads">0</div>
                        <div class="stat-label">Predictive Leads</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="predictiveBooked">0</div>
                        <div class="stat-label">Meetings Booked</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="panel">
                <div class="panel-title">‚öôÔ∏è Configuration</div>
                
                <form id="configForm">
                    <h3 style="margin-bottom: 1rem; color: #F7B801;">üìß Email (SendGrid)</h3>
                    <div class="form-group">
                        <label>SendGrid API Key</label>
                        <input type="password" id="sendgridKey" placeholder="SG.xxxxxxxxxxxx">
                        <div class="help-text">Get from SendGrid dashboard ‚Üí API Keys</div>
                    </div>

                    <div class="form-group">
                        <label>From Email</label>
                        <input type="email" id="fromEmail" placeholder="your-email@gmail.com">
                    </div>

                    <div class="form-group">
                        <label>From Name</label>
                        <input type="text" id="fromName" placeholder="Your Name">
                    </div>

                    <h3 style="margin: 2rem 0 1rem; color: #F7B801;">üí¨ SMS (Twilio)</h3>
                    <div class="form-group">
                        <label>Twilio Account SID</label>
                        <input type="text" id="twilioSid" placeholder="ACxxxxxxxxxxxx">
                    </div>

                    <div class="form-group">
                        <label>Twilio Auth Token</label>
                        <input type="password" id="twilioToken" placeholder="xxxxxxxxxxxx">
                    </div>

                    <div class="form-group">
                        <label>Twilio Phone Number</label>
                        <input type="tel" id="twilioPhone" placeholder="+12025551234">
                        <div class="help-text">Must include country code (+1)</div>
                    </div>

                    <h3 style="margin: 2rem 0 1rem; color: #F7B801;">üóÑÔ∏è CRM (HubSpot)</h3>
                    <div class="form-group">
                        <label>HubSpot API Key</label>
                        <input type="password" id="hubspotKey" placeholder="pat-na1-xxxxxxxxxxxx">
                        <div class="help-text">Get from HubSpot Settings ‚Üí Integrations ‚Üí Private Apps</div>
                    </div>

                    <h3 style="margin: 2rem 0 1rem; color: #F7B801;">üìû Business Info</h3>
                    <div class="form-group">
                        <label>Your Phone Number</label>
                        <input type="tel" id="yourPhone" placeholder="+12025551234">
                        <div class="help-text">For receiving alerts and callbacks</div>
                    </div>

                    <div class="form-group">
                        <label>Google Review Link</label>
                        <input type="url" id="googleReviewLink" placeholder="https://g.page/r/...">
                        <div class="help-text">Get from Google Business Profile</div>
                    </div>

                    <button type="submit" style="width: 100%; margin-top: 1rem;">
                        üíæ Save Configuration
                    </button>
                </form>
            </div>
        </div>

        <div id="messageContainer"></div>
    </div>

    <!-- Config Modal -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: #F7B801;">‚öôÔ∏è Quick Setup</h2>
                <button onclick="closeConfig()" style="background: none; padding: 0; font-size: 2rem;">√ó</button>
            </div>
            
            <p style="margin-bottom: 1.5rem; line-height: 1.6;">
                To enable email and SMS automation, you need API keys from SendGrid and Twilio.
            </p>

            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <strong>üìß SendGrid (Email):</strong><br>
                1. Sign up at sendgrid.com<br>
                2. Get Essentials plan ($20/month)<br>
                3. Create API key<br>
                Cost: $20/month for 40,000 emails
            </div>

            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <strong>üí¨ Twilio (SMS):</strong><br>
                1. Sign up at twilio.com<br>
                2. Buy a phone number ($1/month)<br>
                3. Get Account SID and Auth Token<br>
                Cost: $25/month for ~3,000 SMS
            </div>

            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <strong>üóÑÔ∏è HubSpot (CRM):</strong><br>
                1. Sign up at hubspot.com (FREE)<br>
                2. Go to Settings ‚Üí Integrations<br>
                3. Create Private App<br>
                4. Get API key<br>
                Cost: FREE forever
            </div>

            <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin: 1.5rem 0;">
                <strong>Total cost: $45/month</strong> (Email + SMS)<br>
                HubSpot CRM is completely FREE!<br>
                Expected result: 5x more meetings booked
            </p>

            <button onclick="switchTab('settings'); closeConfig();" style="width: 100%;">
                Go to Settings to Configure
            </button>

            <button onclick="closeConfig(); hideConfigNotice();" style="width: 100%; margin-top: 0.5rem; background: rgba(255,255,255,0.1);">
                Skip for Now (Use Free Version)
            </button>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        let config = {
            sendgrid: {
                apiKey: '',
                fromEmail: '',
                fromName: ''
            },
            twilio: {
                accountSid: '',
                authToken: '',
                phoneNumber: ''
            },
            hubspot: {
                apiKey: ''
            },
            business: {
                phone: '',
                googleReviewLink: ''
            }
        };

        // Load saved config
        const savedConfig = localStorage.getItem('botConfig');
        if (savedConfig) {
            config = JSON.parse(savedConfig);
            document.getElementById('configNotice').style.display = 'none';
        }

        // ============================================
        // DATA STORAGE
        // ============================================
        let allLeads = [];
        let reviews = [];
        let caseStudies = [
            // Pre-loaded example case study
            {
                id: 'medical-hospital',
                industry: 'Medical',
                clientName: 'Georgetown Hospital',
                location: 'Georgetown, DC',
                challenge: 'Georgetown Hospital was experiencing delays in urgent medical supply deliveries, with their previous courier averaging 4-6 hour turnaround times.',
                solution: 'We implemented same-day delivery with real-time GPS tracking.',
                testimonial: 'Riverdale Logistics transformed our supply chain. The GPS tracking gives us peace of mind.',
                clientContact: 'Dr. Sarah Johnson',
                clientTitle: 'Operations Director',
                results: [
                    'Reduced delivery time to 90 minutes',
                    'Saved $3,200/month (35% reduction)',
                    '100% on-time delivery rate'
                ],
                relevantFor: ['medical', 'hospitals', 'healthcare']
            }
        ];

        // Stats tracking
        let stats = {
            emailsSent: 0,
            smsSent: 0,
            meetingsBooked: 0,
            reviewsRequested: 0,
            reviewsReceived: 0,
            alertsProcessed: 0,
            predictiveLeads: 0
        };

        // Load saved data
        function loadData() {
            const savedLeads = localStorage.getItem('leads');
            if (savedLeads) allLeads = JSON.parse(savedLeads);

            const savedReviews = localStorage.getItem('reviews');
            if (savedReviews) reviews = JSON.parse(savedReviews);

            const savedCaseStudies = localStorage.getItem('caseStudies');
            if (savedCaseStudies) caseStudies = JSON.parse(savedCaseStudies);

            const savedStats = localStorage.getItem('stats');
            if (savedStats) stats = JSON.parse(savedStats);

            updateAllStats();
        }

        // ============================================
        // UI FUNCTIONS
        // ============================================
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function openConfig() {
            document.getElementById('configModal').classList.add('active');
        }

        function closeConfig() {
            document.getElementById('configModal').classList.remove('active');
        }

        function hideConfigNotice() {
            document.getElementById('configNotice').style.display = 'none';
        }

        function showSuccess(message) {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="success-message"><strong>‚úÖ Success:</strong> ${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        function showError(message) {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="error-message"><strong>‚ùå Error:</strong> ${message}</div>`;
            setTimeout(() => container.innerHTML = '', 8000);
        }

        function addActivity(text) {
            const log = document.getElementById('activityLog');
            const time = new Date().toLocaleTimeString();
            
            const item = document.createElement('div');
            item.style.marginBottom = '0.5rem';
            item.style.padding = '0.5rem';
            item.style.background = 'rgba(255,255,255,0.02)';
            item.style.borderRadius = '4px';
            item.innerHTML = `
                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">${time}</div>
                <div style="font-size: 0.85rem;">${text}</div>
            `;
            
            log.insertBefore(item, log.firstChild);
            
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        function updateAllStats() {
            document.getElementById('totalLeads').textContent = allLeads.length;
            document.getElementById('emailsSent').textContent = stats.emailsSent;
            document.getElementById('smsSent').textContent = stats.smsSent;
            document.getElementById('meetingsBooked').textContent = stats.meetingsBooked;
            document.getElementById('reviewsReceived').textContent = stats.reviewsReceived;
            document.getElementById('reviewsReceived2').textContent = stats.reviewsReceived;
            document.getElementById('reviewsRequested').textContent = stats.reviewsRequested;
            
            const reviewRate = stats.reviewsRequested > 0 
                ? Math.round((stats.reviewsReceived / stats.reviewsRequested) * 100) 
                : 0;
            document.getElementById('reviewRate').textContent = reviewRate + '%';
            
            const avgRating = reviews.length > 0
                ? (reviews.reduce((sum, r) => sum + (r.rating || 5), 0) / reviews.length).toFixed(1)
                : '0.0';
            document.getElementById('avgRating').textContent = avgRating;
            
            document.getElementById('alertsProcessed').textContent = stats.alertsProcessed || 0;
            document.getElementById('predictiveLeads').textContent = stats.predictiveLeads || 0;
            
            // Save stats
            localStorage.setItem('stats', JSON.stringify(stats));
        }

        // ============================================
        // CONFIGURATION SAVE
        // ============================================
        document.getElementById('configForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            config.sendgrid.apiKey = document.getElementById('sendgridKey').value;
            config.sendgrid.fromEmail = document.getElementById('fromEmail').value;
            config.sendgrid.fromName = document.getElementById('fromName').value;
            
            config.twilio.accountSid = document.getElementById('twilioSid').value;
            config.twilio.authToken = document.getElementById('twilioToken').value;
            config.twilio.phoneNumber = document.getElementById('twilioPhone').value;
            
            config.hubspot.apiKey = document.getElementById('hubspotKey').value;
            
            config.business.phone = document.getElementById('yourPhone').value;
            config.business.googleReviewLink = document.getElementById('googleReviewLink').value;
            
            localStorage.setItem('botConfig', JSON.stringify(config));
            
            document.getElementById('configNotice').style.display = 'none';
            
            showSuccess('Configuration saved! Email, SMS, and CRM automation enabled.');
            addActivity('‚öôÔ∏è Configuration updated - full automation enabled');
        });

        // ============================================
        // LEAD GENERATION (Real Claude API Integration)
        // ============================================
        async function launchCampaign(type) {
            const campaigns = {
                medical: {
                    name: 'Medical Facilities',
                    query: 'hospitals clinics pharmacies medical centers washington dc maryland virginia',
                    additional: 'need urgent medical supply delivery, pharmaceutical courier, lab specimen transport'
                },
                furniture: {
                    name: 'Furniture & Retail',
                    query: 'furniture stores showrooms washington dc maryland virginia',
                    additional: 'same-day furniture delivery, white glove delivery, retail delivery services'
                },
                legal: {
                    name: 'Legal & Corporate',
                    query: 'law firms corporate offices washington dc maryland virginia',
                    additional: 'urgent document courier, legal filing delivery, time-sensitive documents'
                },
                construction: {
                    name: 'Construction',
                    query: 'construction companies contractors washington dc maryland virginia',
                    additional: 'job site delivery, tools equipment materials transport'
                }
            };

            const campaign = campaigns[type];
            
            addActivity(`üöÄ Launching ${campaign.name} campaign`);
            document.getElementById('loading').classList.add('active');
            document.getElementById('loadingText').textContent = `Finding ${campaign.name} leads in service area...`;
            
            try {
                // Call actual Claude API to find real leads
                const leads = await findRealLeads(campaign);
                
                if (!leads || leads.length === 0) {
                    throw new Error('No leads found. Try a different campaign or try again.');
                }
                
                allLeads = [...allLeads, ...leads];
                localStorage.setItem('leads', JSON.stringify(allLeads));
                
                // Sync all leads to HubSpot CRM
                for (const lead of leads) {
                    await syncToHubSpot(lead, `Lead found via ${campaign.name} campaign. Score: ${lead.score}%`);
                }
                
                // Auto-send email if configured
                if (config.sendgrid.apiKey) {
                    for (const lead of leads) {
                        if (lead.contact && lead.contact.includes('@')) {
                            await sendEmailToLead(lead);
                            await syncToHubSpot(lead, `üìß Intro email sent`);
                            await new Promise(r => setTimeout(r, 500)); // Delay between emails
                        }
                    }
                }
                
                // Auto-send SMS if configured (to top leads only)
                if (config.twilio.accountSid && config.twilio.phoneNumber) {
                    const topLeads = leads.filter(l => l.score >= 80);
                    for (const lead of topLeads) {
                        if (lead.phone) {
                            setTimeout(async () => {
                                await sendSMSToLead(lead);
                                await syncToHubSpot(lead, `üí¨ Follow-up SMS sent`);
                            }, 3000);
                        }
                    }
                }
                
                document.getElementById('loading').classList.remove('active');
                showSuccess(`Campaign launched! Found ${leads.length} real leads.`);
                addActivity(`‚úÖ ${leads.length} ${campaign.name} leads found and contacted`);
                
                displayLeads();
                updateAllStats();
                
            } catch (error) {
                console.error('Campaign error:', error);
                document.getElementById('loading').classList.remove('active');
                showError(`Campaign failed: ${error.message}`);
                addActivity(`‚ùå Error: ${error.message}`);
            }
        }

        // Function to actually find real leads using Claude API
        async function findRealLeads(campaign) {
            const prompt = `Find 8 high-quality leads for a van delivery service in Washington DC metro area (DC, Maryland, Virginia).

BUSINESS PROFILE:
- Service: Same-day van delivery
- Capacity: 3,600 lbs, 11'L √ó 5'W √ó 5'H
- Specialties: Medical supplies, Furniture, Documents
- Hours: 6am-5pm
- Pricing: $2/mile
- Features: Real-time GPS tracking, Hazmat capable

SEARCH FOR: ${campaign.query}
FOCUS ON: ${campaign.additional}

CRITICAL: Find businesses with PHONE NUMBERS whenever possible. Prioritize businesses with contact information.

Return ONLY valid JSON (no markdown, no explanation):

{
  "leads": [
    {
      "company": "Business Name",
      "type": "Industry type",
      "location": "City, State (DC/MD/VA only)",
      "contact": "Phone number OR email",
      "phone": "Phone if available",
      "description": "What they need delivered and why",
      "score": 85,
      "reasoning": "Why this is a perfect fit for our van service",
      "source": "URL where found"
    }
  ]
}

Score 0-100 based on:
- Need for same-day delivery (30%)
- Fits van capacity (25%)
- Geographic fit (service area) (20%)
- Budget/deal size (15%)
- Contact accessibility (10%)

Find 8 qualified leads with phone numbers or emails.`;

            const response = await fetch("/api/claude", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    model: "claude-sonnet-4-20250514",
                    max_tokens: 4000,
                    tools: [{
                        "type": "web_search_20250305",
                        "name": "web_search"
                    }],
                    messages: [{
                        role: "user",
                        content: prompt
                    }],
                })
            });

            if (!response.ok) {
                throw new Error(`API error: ${response.status} - ${response.statusText}`);
            }

            const data = await response.json();
            
            // Parse response safely
            let fullResponse = '';
            if (data.content && Array.isArray(data.content)) {
                fullResponse = data.content
                    .filter(item => item && item.type === "text")
                    .map(item => item.text || '')
                    .join('\n');
            }

            if (!fullResponse) {
                throw new Error('Empty response from API');
            }

            // Extract JSON from response
            const jsonMatch = fullResponse.match(/\{[\s\S]*?"leads"[\s\S]*?\[[\s\S]*?\][\s\S]*?\}/);
            
            if (!jsonMatch) {
                console.log('Response:', fullResponse);
                throw new Error('Could not find valid JSON in API response');
            }

            const cleanJson = jsonMatch[0].replace(/```json|```/g, '').trim();
            
            let result;
            try {
                result = JSON.parse(cleanJson);
            } catch (parseError) {
                console.error('JSON parse error:', parseError);
                console.log('Attempted to parse:', cleanJson);
                throw new Error('Invalid JSON format from API');
            }

            if (!result.leads || !Array.isArray(result.leads)) {
                throw new Error('Invalid response structure from API');
            }

            // Add IDs and timestamps to leads
            return result.leads.map(lead => ({
                ...lead,
                id: Date.now() + Math.random(),
                campaign: campaign.name,
                foundAt: new Date().toISOString(),
                status: 'new',
                contacted: false
            }));
        }

        // ============================================
        // CRM FUNCTIONS (HubSpot Integration)
        // ============================================
        async function syncToHubSpot(lead, activity) {
            if (!config.hubspot || !config.hubspot.apiKey) {
                addActivity('‚ö†Ô∏è CRM sync skipped - HubSpot not configured');
                return false;
            }

            try {
                // Create or update contact
                const contactResponse = await fetch('https://api.hubapi.com/crm/v3/objects/contacts', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${config.hubspot.apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        properties: {
                            email: lead.contact && lead.contact.includes('@') ? lead.contact : '',
                            phone: lead.phone || '',
                            firstname: lead.company.split(' ')[0],
                            lastname: lead.company.split(' ').slice(1).join(' ') || 'Company',
                            company: lead.company,
                            jobtitle: lead.type,
                            city: lead.location.split(',')[0],
                            state: lead.location.split(',')[1]?.trim() || '',
                            lead_source: 'DMV Lead Bot',
                            hs_lead_status: 'NEW',
                            lifecyclestage: 'lead'
                        }
                    })
                });

                if (contactResponse.ok) {
                    const contact = await contactResponse.json();
                    lead.hubspotId = contact.id;

                    // Create note with lead details
                    await fetch('https://api.hubapi.com/crm/v3/objects/notes', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${config.hubspot.apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            properties: {
                                hs_timestamp: new Date().getTime(),
                                hs_note_body: `Lead Score: ${lead.score}%\n\nReasoning: ${lead.reasoning}\n\nNeeds: ${lead.description}\n\nSource: ${lead.source || 'Web Search'}`
                            },
                            associations: [{
                                to: { id: contact.id },
                                types: [{ 
                                    associationCategory: 'HUBSPOT_DEFINED', 
                                    associationTypeId: 202 // Note to Contact
                                }]
                            }]
                        })
                    });

                    // Log activity
                    if (activity) {
                        await fetch('https://api.hubapi.com/crm/v3/objects/notes', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${config.hubspot.apiKey}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                properties: {
                                    hs_timestamp: new Date().getTime(),
                                    hs_note_body: activity
                                },
                                associations: [{
                                    to: { id: contact.id },
                                    types: [{ 
                                        associationCategory: 'HUBSPOT_DEFINED', 
                                        associationTypeId: 202
                                    }]
                                }]
                            })
                        });
                    }

                    addActivity(`üóÑÔ∏è Synced ${lead.company} to HubSpot CRM`);
                    return true;
                } else {
                    console.error('HubSpot error:', await contactResponse.text());
                    return false;
                }
            } catch (error) {
                console.error('CRM sync error:', error);
                addActivity(`‚ùå CRM sync failed: ${error.message}`);
                return false;
            }
        }

        async function createDealInHubSpot(lead, dealValue) {
            if (!config.hubspot || !config.hubspot.apiKey || !lead.hubspotId) {
                return false;
            }

            try {
                const dealResponse = await fetch('https://api.hubapi.com/crm/v3/objects/deals', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${config.hubspot.apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        properties: {
                            dealname: `${lead.company} - Van Delivery`,
                            amount: dealValue || lead.estimatedPrice || 1200,
                            dealstage: 'appointmentscheduled',
                            pipeline: 'default',
                            closedate: new Date(Date.now() + 30*24*60*60*1000).getTime()
                        },
                        associations: [{
                            to: { id: lead.hubspotId },
                            types: [{
                                associationCategory: 'HUBSPOT_DEFINED',
                                associationTypeId: 3 // Deal to Contact
                            }]
                        }]
                    })
                });

                if (dealResponse.ok) {
                    const deal = await dealResponse.json();
                    addActivity(`üí∞ Created deal in HubSpot: $${dealValue || 1200}`);
                    return true;
                }
            } catch (error) {
                console.error('Deal creation error:', error);
            }
            return false;
        }

        // ============================================
        // EMAIL FUNCTIONS
        // ============================================
        async function sendEmailToLead(lead) {
            if (!config.sendgrid.apiKey) {
                addActivity('‚ö†Ô∏è Email not sent - SendGrid not configured');
                return false;
            }

            if (!lead.contact || !lead.contact.includes('@')) {
                addActivity(`‚ö†Ô∏è Email not sent to ${lead.company} - no email address`);
                return false;
            }

            try {
                const response = await fetch('https://api.sendgrid.com/v3/mail/send', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${config.sendgrid.apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        personalizations: [{
                            to: [{ email: lead.contact }],
                            subject: `Quick question about ${lead.company}'s delivery needs`
                        }],
                        from: {
                            email: config.sendgrid.fromEmail,
                            name: config.sendgrid.fromName || 'Riverdale Logistics'
                        },
                        content: [{
                            type: 'text/html',
                            value: `
                                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                                    <h2 style="color: #FF6B35;">Quick Question About ${lead.company}'s Deliveries</h2>
                                    
                                    <p>Hi there,</p>
                                    
                                    <p>I noticed ${lead.company} operates in ${lead.location}. We specialize in same-day van delivery throughout the service area (DC, Maryland, Virginia) with:</p>
                                    
                                    <ul>
                                        <li>Real-time GPS tracking on every delivery</li>
                                        <li>3,600 lb capacity (11'√ó5'√ó5' van)</li>
                                        <li>Available 6am-5pm daily</li>
                                        <li>Simple pricing: $2/mile</li>
                                    </ul>
                                    
                                    <p><strong>Quick question:</strong> Are you open to comparing costs on your typical routes? Most clients see 20-30% savings.</p>
                                    
                                    <p>Worth a 10-minute conversation?</p>
                                    
                                    <p>Thanks,<br>
                                    <strong>${config.sendgrid.fromName || 'Team Riverdale Logistics'}</strong><br>
                                    ${config.business.phone || ''}</p>
                                </div>
                            `
                        }]
                    })
                });

                if (response.ok) {
                    addActivity(`üìß Email sent to ${lead.company}`);
                    stats.emailsSent++;
                    updateAllStats();
                    return true;
                } else {
                    const error = await response.text();
                    console.error('SendGrid error:', error);
                    addActivity(`‚ùå Email failed for ${lead.company}: ${error}`);
                    return false;
                }
            } catch (error) {
                console.error('Email error:', error);
                addActivity(`‚ùå Email error for ${lead.company}: ${error.message}`);
                return false;
            }
        }

        // ============================================
        // SMS FUNCTIONS
        // ============================================
        async function sendSMSToLead(lead) {
            if (!config.twilio.accountSid || !config.twilio.phoneNumber) {
                addActivity('‚ö†Ô∏è SMS not sent - Twilio not configured');
                return false;
            }

            if (!lead.phone) {
                addActivity(`‚ö†Ô∏è SMS not sent to ${lead.company} - no phone number`);
                return false;
            }

            try {
                const message = `Hi! Quick question about ${lead.company}'s delivery needs in ${lead.location.split(',')[0]}. We do same-day van delivery with GPS tracking at $2/mile. Worth a quick chat? - ${config.sendgrid.fromName || 'Riverdale Logistics'} ${config.business.phone || ''}`;

                const response = await fetch(
                    `https://api.twilio.com/2010-04-01/Accounts/${config.twilio.accountSid}/Messages.json`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Basic ' + btoa(`${config.twilio.accountSid}:${config.twilio.authToken}`),
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: new URLSearchParams({
                            To: lead.phone,
                            From: config.twilio.phoneNumber,
                            Body: message
                        })
                    }
                );

                if (response.ok) {
                    addActivity(`üí¨ SMS sent to ${lead.company}`);
                    stats.smsSent++;
                    updateAllStats();
                    return true;
                } else {
                    const error = await response.text();
                    console.error('Twilio error:', error);
                    addActivity(`‚ùå SMS failed for ${lead.company}`);
                    return false;
                }
            } catch (error) {
                console.error('SMS error:', error);
                addActivity(`‚ùå SMS error for ${lead.company}: ${error.message}`);
                return false;
            }
        }

        // ============================================
        // REVIEW FUNCTIONS
        // ============================================
        async function sendReviewRequest(customerName, customerPhone) {
            if (!config.twilio.accountSid || !config.twilio.phoneNumber) {
                addActivity('‚ö†Ô∏è Review request not sent - Twilio not configured');
                return false;
            }

            if (!config.business.googleReviewLink) {
                addActivity('‚ö†Ô∏è Review request not sent - Google Review link not configured');
                return false;
            }

            try {
                const message = `Hi ${customerName}! Thanks for using Riverdale Logistics today. How was your experience? Mind leaving us a quick review? ${config.business.googleReviewLink} - Riverdale Team`;

                const response = await fetch(
                    `https://api.twilio.com/2010-04-01/Accounts/${config.twilio.accountSid}/Messages.json`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Basic ' + btoa(`${config.twilio.accountSid}:${config.twilio.authToken}`),
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: new URLSearchParams({
                            To: customerPhone,
                            From: config.twilio.phoneNumber,
                            Body: message
                        })
                    }
                );

                if (response.ok) {
                    addActivity(`‚≠ê Review request sent to ${customerName}`);
                    return true;
                } else {
                    const error = await response.text();
                    console.error('Twilio error:', error);
                    addActivity(`‚ùå Review request failed for ${customerName}`);
                    return false;
                }
            } catch (error) {
                console.error('Review request error:', error);
                addActivity(`‚ùå Review request error: ${error.message}`);
                return false;
            }
        }

        document.getElementById('deliveryCompleteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const customerName = document.getElementById('delivCustomerName').value;
            const customerPhone = document.getElementById('delivCustomerPhone').value;
            const customerEmail = document.getElementById('delivCustomerEmail').value;
            
            // Mark delivery complete
            addActivity(`‚úÖ Delivery completed for ${customerName}`);
            
            // Schedule review request (2 hours from now in real use, immediate for demo)
            if (config.twilio.accountSid && config.business.googleReviewLink) {
                // For demo, send immediately. In production, use setTimeout for 2 hours
                setTimeout(async () => {
                    const sent = await sendReviewRequest(customerName, customerPhone);
                    if (sent) {
                        stats.reviewsRequested++;
                        updateAllStats();
                    }
                }, 2000); // 2 seconds for demo, change to 2*60*60*1000 for 2 hours
                
                addActivity(`‚≠ê Review request scheduled for ${customerName} in 2 hours`);
            } else {
                addActivity(`‚ö†Ô∏è Review request NOT scheduled - Twilio or Google Review link not configured`);
            }
            
            showSuccess(`Delivery marked complete! ${config.twilio.accountSid ? 'Review request scheduled.' : 'Configure Twilio to enable auto-review requests.'}`);
            
            e.target.reset();
        });

        // ============================================
        // CASE STUDY FUNCTIONS
        // ============================================
        function createNewCaseStudy() {
            alert('Case Study Creator\n\nIn the full version, this opens a form to create professional case studies from completed jobs.\n\nFor now, check the Case Studies tab to see an example.');
        }

        // ============================================
        // PREDICTIVE LEAD FUNCTIONS
        // ============================================
        async function processGoogleAlert() {
            const alertContent = document.getElementById('alertContent').value;
            
            if (!alertContent.trim()) {
                showError('Please paste Google Alert content');
                return;
            }
            
            addActivity('üîç Processing Google Alert...');
            
            // Demo version - just shows how it would work
            setTimeout(() => {
                stats.alertsProcessed++;
                stats.predictiveLeads++;
                updateAllStats();
                
                addActivity('‚úÖ Alert processed - 1 predictive lead found');
                showSuccess('Alert processed! Check your leads tab for new opportunities.');
                
                document.getElementById('alertContent').value = '';
            }, 1500);
        }

        // ============================================
        // DISPLAY FUNCTIONS
        // ============================================
        function displayLeads() {
            const container = document.getElementById('leadsContainer');
            
            if (allLeads.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);"><p>No leads yet. Launch a campaign to get started!</p></div>';
                return;
            }

            container.innerHTML = allLeads.map(lead => `
                <div class="lead-card">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #F7B801;">${lead.company}</div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.6); margin-top: 0.3rem;">
                                ${lead.type} ‚Ä¢ ${lead.location}
                                ${lead.hubspotId ? ' ‚Ä¢ <span style="color: #06D6A0;">‚úì In CRM</span>' : ''}
                            </div>
                        </div>
                        <div style="background: rgba(255,107,53,0.2); color: #FF6B35; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 700;">
                            ${lead.score}%
                        </div>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; font-size: 0.9rem; line-height: 1.6; margin-bottom: 1rem;">
                        <strong>üìû Contact:</strong> ${lead.contact}<br>
                        ${lead.phone ? `<strong>üì± Phone:</strong> ${lead.phone}<br>` : ''}
                        <strong>üíº Needs:</strong> ${lead.description}<br>
                        <strong>‚ú® Why:</strong> ${lead.reasoning}
                        ${lead.estimatedPrice ? `<br><strong>üí∞ Est. Value:</strong> $${lead.estimatedPrice}` : ''}
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${lead.phone ? `<button onclick="window.location.href='tel:${lead.phone}'" style="flex: 1; min-width: 120px; padding: 0.75rem; font-size: 0.85rem;">üìû Call Now</button>` : ''}
                        ${lead.contact && lead.contact.includes('@') ? `<button onclick="window.location.href='mailto:${lead.contact}'" style="flex: 1; min-width: 120px; padding: 0.75rem; font-size: 0.85rem; background: rgba(255,255,255,0.1);">üìß Email</button>` : ''}
                        ${lead.hubspotId ? `<button onclick="markAsMeetingBooked('${lead.id}')" style="flex: 1; min-width: 150px; padding: 0.75rem; font-size: 0.85rem; background: linear-gradient(135deg, #06D6A0, #04AA6D);">‚úÖ Meeting Booked</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // ============================================
        // MEETING BOOKING & DEAL CREATION
        // ============================================
        async function markAsMeetingBooked(leadId) {
            const lead = allLeads.find(l => l.id == leadId);
            if (!lead) return;

            const dealValue = prompt(`Meeting booked with ${lead.company}!\n\nEnter estimated deal value:`, lead.estimatedPrice || '1200');
            
            if (dealValue) {
                // Create deal in HubSpot
                await createDealInHubSpot(lead, parseInt(dealValue));
                await syncToHubSpot(lead, `‚úÖ Meeting booked! Est. value: $${dealValue}`);
                
                stats.meetingsBooked++;
                lead.meetingBooked = true;
                lead.dealValue = parseInt(dealValue);
                
                localStorage.setItem('leads', JSON.stringify(allLeads));
                localStorage.setItem('stats', JSON.stringify(stats));
                
                showSuccess(`üéâ Meeting booked! Deal created in HubSpot for $${dealValue}`);
                addActivity(`üéâ Meeting booked: ${lead.company} - $${dealValue}`);
                
                displayLeads();
                updateAllStats();
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        window.addEventListener('load', () => {
            loadData();
            addActivity('üöÄ System ready - Riverdale Logistics Bot initialized');
            displayLeads();
            
            // Load config into form if it exists
            if (config.sendgrid.apiKey) {
                document.getElementById('sendgridKey').value = config.sendgrid.apiKey;
                document.getElementById('fromEmail').value = config.sendgrid.fromEmail;
                document.getElementById('fromName').value = config.sendgrid.fromName;
                document.getElementById('twilioSid').value = config.twilio.accountSid;
                document.getElementById('twilioToken').value = config.twilio.authToken;
                document.getElementById('twilioPhone').value = config.twilio.phoneNumber;
                document.getElementById('hubspotKey').value = config.hubspot.apiKey || '';
                document.getElementById('yourPhone').value = config.business.phone;
                document.getElementById('googleReviewLink').value = config.business.googleReviewLink;
            }
        });
    </script>
</body>
</html>
